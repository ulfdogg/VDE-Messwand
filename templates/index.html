{% extends "base.html" %}

{% block content %}
<div class="glass-card">
    <h1>VDE Messwand Steuerung</h1>

    {% if wallbox_installed %}
    <!-- Wallbox Toggle - nur anzeigen wenn Wallbox vorhanden -->
    <div class="wallbox-toggle" style="margin-bottom: 25px; padding: 15px; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border: 2px solid rgba(255, 255, 255, 0.1);">
        <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-size: 1.1em;">
            <input type="checkbox" id="wallboxEnabled" {% if wallbox_enabled %}checked{% endif %}
                   style="width: 22px; height: 22px; accent-color: #ff4444; cursor: pointer;">
            <span>Wallbox-Stromkreis aktivieren</span>
        </label>
        <p style="margin: 8px 0 0 34px; font-size: 0.85em; opacity: 0.7;">
            Wenn deaktiviert, werden Wallbox-Relais im Prüfungsmodus ignoriert und im manuellen Modus ausgegraut.
        </p>
    </div>
    {% endif %}

    <div class="menu-grid">
        <a href="{{ url_for('exam_mode') }}" class="menu-item">
            <h3>Prüfungsmodus</h3>
            <p>Automatische Prüfung mit zufälligen Fehlern und 20-Minuten Timer</p>
        </a>

        <a href="{{ url_for('manual_mode') }}" class="menu-item">
            <h3>Manuelle Fehler</h3>
            <p>Gezieltes Zuschalten von Fehlern in einzelnen Stromkreisen</p>
        </a>

        <a href="{{ url_for('training_mode') }}" class="menu-item">
            <h3>Übungsmodus</h3>
            <p>Anleitungen und Videos für verschiedene Messgeräte</p>
        </a>

        <a href="{{ url_for('admin') }}" class="menu-item">
            <h3>Admin Bereich</h3>
            <p>Datenbank, Netzwerk und Systemverwaltung</p>
        </a>
    </div>
</div>

<script>
// Wallbox Toggle nur wenn vorhanden
const wallboxToggle = document.getElementById('wallboxEnabled');
if (wallboxToggle) {
    wallboxToggle.addEventListener('change', async function() {
        try {
            const response = await fetch('/api/wallbox/toggle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    enabled: this.checked
                })
            });
            const result = await response.json();
            if (!result.success) {
                alert('Fehler beim Speichern: ' + (result.message || 'Unbekannter Fehler'));
                this.checked = !this.checked;
            }
        } catch (error) {
            alert('Verbindungsfehler: ' + error.message);
            this.checked = !this.checked;
        }
    });
}
</script>
{% endblock %}